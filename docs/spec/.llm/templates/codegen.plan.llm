# Plan: Code Generation — {Feature Name}

> Use this template when implementing code for a feature that has (or needs) a technical specification.
> This enforces the spec-first protocol: no code without a spec, no implementation without a plan.

## Metadata

| Field | Value |
|-------|-------|
| **Created** | {timestamp} |
| **Agent ID** | {agent-id} |
| **Status** | planning |
| **Priority** | medium |
| **Depends On** | none |
| **Branch** | feature/{feature-name} |
| **Spec Path** | docs/spec/{spec-path} |

---

## Phase 1: Analyze Requirements

- [ ] Read the business spec (`biz/{feature-name}.md`) if it exists
- [ ] Read relevant framework specs (`docs/spec/framework/`)
- [ ] Identify all requirements, constraints, and acceptance criteria
- [ ] List unknowns or ambiguities that need resolution

---

## Phase 2: Create Technical Code Spec

> If a technical spec already exists at the Spec Path above, read and verify it instead.

Create or update the technical spec covering:

- [ ] **Data Models**: Entity definitions, field types, constraints, relationships
- [ ] **API Contracts**: Endpoints, request/response shapes, status codes, error codes
- [ ] **Error Handling**: Error types, recovery strategies, user-facing messages
- [ ] **State Management**: State transitions, invariants, side effects
- [ ] **Performance**: Latency budgets, memory constraints, concurrency model
- [ ] **Security**: AuthN/AuthZ requirements, input validation, data sanitization
- [ ] **Testing Strategy**: Unit/integration/E2E test plan, edge cases, fixtures
- [ ] **Dependencies**: External packages, services, infrastructure requirements

Spec location: `docs/spec/{appropriate-location}.md`

### USER CHECKPOINT 1

> **Present the technical spec to the user.** Ask:
> - Does this spec capture the full requirements?
> - Are the API contracts and data models correct?
> - Any edge cases or error scenarios missing?
> - Ready to proceed to implementation planning?

- [ ] User reviewed technical spec
- [ ] User approved spec
- [ ] Feedback incorporated

---

## Phase 3: Create Implementation Plan

Based on the approved spec, plan the implementation:

- [ ] Define implementation phases (each independently testable)
- [ ] List files to create and modify per phase
- [ ] Define quality gates for each phase
- [ ] Identify parallelizable work

### USER CHECKPOINT 2

> **Present the implementation plan to the user.** Ask:
> - Does the phase ordering make sense?
> - Is the scope appropriate for each phase?
> - Ready to start implementation?

- [ ] User reviewed implementation plan
- [ ] User approved plan
- [ ] Feedback incorporated

---

## Phase 4: Implement Against Spec

For each implementation phase:

- [ ] **Reference the spec** before writing each component
- [ ] **Match the spec exactly**: data models, API contracts, error codes, status codes
- [ ] **Write production-quality code**: error handling, input validation, edge cases
- [ ] **Write tests alongside code**: unit tests, integration tests as specified in the testing strategy
- [ ] **Run quality gates** after each phase (build, test, lint)
- [ ] **Cross-reference** implementation against spec — verify every contract is honored

### Implementation Phases

#### Phase 4.1: {First Phase}

- [ ] Files created/modified: {list}
- [ ] Spec sections referenced: {list}
- [ ] Tests written: {list}
- [ ] Quality gates pass

#### Phase 4.2: {Second Phase}

- [ ] Files created/modified: {list}
- [ ] Spec sections referenced: {list}
- [ ] Tests written: {list}
- [ ] Quality gates pass

_(Add more phases as needed)_

---

## Phase 5: Spec Compliance Verification

- [ ] Every data model matches the spec (fields, types, constraints)
- [ ] Every API endpoint matches the spec (paths, methods, request/response shapes)
- [ ] Every error code and status code matches the spec
- [ ] All edge cases from the spec are handled
- [ ] All test scenarios from the testing strategy are implemented
- [ ] Performance requirements from the spec are met

---

## Phase 6: Quality Gates

- [ ] All quality gates pass (build, test, lint from AGENT_GUIDE.md)
- [ ] Test coverage meets project standards
- [ ] No spec deviations remain
- [ ] PROGRESS.md updated with learnings
- [ ] User has reviewed the completed implementation

---

## Decisions

### Decision 1: {Topic}

- **Choice**: {decision}
- **Alternatives**: {considered}
- **Rationale**: {why}
- **Spec Reference**: {section of spec that informed this}

---

## Progress Log

### {timestamp}

- Started: Requirements analysis
- Next: Create technical spec

---

## Completion

| Field | Value |
|-------|-------|
| **Spec Created** | {timestamp} |
| **Spec Approved** | {timestamp} |
| **Plan Approved** | {timestamp} |
| **Implementation Complete** | {timestamp} |
| **Compliance Verified** | {timestamp} |
| **Notes** | {Any final notes} |
